import{u as S,r as h,A as k,h as q,j as e,i as W,S as i,k as f,l as _,J as T,o as C,n as F,T as x,q as B,f as I,g as z,P as H,s as L,t as R,H as g,L as V,C as b,d as A,G as E,x as G,y as N,z as O,I as v,D as P,V as $,e as M,v as J,W as K}from"./index-P0oc4blE.js";function X(a){var t,o;const s=S(),l=h.useContext(k),{register:r,handleSubmit:m,formState:{errors:n,isSubmitting:c},reset:j,watch:d}=q({defaultValues:{condition_type:"greater_and_equal"}}),p=async u=>{var w;const y=await I.post("/dashboard/widgets/create",{...u,condition_amount:(u.condition_amount*100).toFixed(0)},(w=l.props.auth)==null?void 0:w.token);if(y.errors){z(y.errors,s);return}await a.refreshData(),j(),a.onClose()};return e.jsx(W,{title:"создать виджет",...a,children:e.jsx("form",{onSubmit:m(p),children:e.jsxs(i,{direction:"column",spacing:2,children:[e.jsxs(f,{isInvalid:!!n.condition_type,children:[e.jsx(_,{children:"условие"}),e.jsxs(T,{isDisabled:c,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...r("condition_type",{required:!0}),children:[e.jsx("option",{value:"greater",children:"больше"}),e.jsx("option",{value:"greater_and_equal",children:"больше или равно"}),e.jsx("option",{value:"equal",children:"равно"})]}),e.jsx(C,{error:n.condition_type})]}),e.jsxs(f,{isInvalid:!!n.condition_type,children:[e.jsxs(_,{children:["сумма в ",(t=l.props.auth)==null?void 0:t.profile.default_currency]}),e.jsx(F,{isDisabled:c,placeholder:"введите сумму",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},...r("condition_amount",{required:!0,valueAsNumber:!0,validate:u=>u>0||"bad_number"})}),e.jsx(C,{error:n.condition_type})]}),e.jsxs(x,{fontSize:"sm",children:["виджет сработает только если сумма доната"," ",D[d("condition_type")]," ",d("condition_amount")||0," ",(o=l.props.auth)==null?void 0:o.profile.default_currency]}),e.jsx(B,{type:"submit",isDisabled:c,children:"создать"})]})})})}const D={equal:"равна",greater_and_equal:"больше или равна",greater:"больше"};function U(){var p;const a=S(),s=h.useContext(k),l=H(),[r,m]=h.useState(),n=async()=>{var o;const t=await I.get("/dashboard/widgets",void 0,(o=s.props.auth)==null?void 0:o.token);if(t.errors){z(t.errors,a);return}m(t.widgets)};h.useEffect(()=>{n()},[]);const[c,j]=L(),d=R();return e.jsxs(i,{direction:"column",spacing:4,children:[e.jsxs(i,{direction:"column",spacing:2,children:[e.jsx(g,{children:"виджет оповещений"}),e.jsxs(i,{direction:["column","row"],justifyContent:"space-between",alignItems:["start","center"],spacing:2,children:[e.jsx(x,{opacity:"0.5",fontSize:"sm",pr:["0px","100px"],children:"виджет оповещений служит для отображения новых донатов. виджет оповещений о сообщениях можно встроить двумя способами: открыв через браузер или запустив его через OBS, XSplit или Kast с использованием специальной ссылки."}),(r==null?void 0:r.length)!==0?e.jsx(V,{flexShrink:"0",userSelect:"none",onClick:j.toggle,children:c?"скрыть ссылку для встраивания":"показать ссылку для встраивания"}):e.jsx(e.Fragment,{})]})]}),r?e.jsxs(e.Fragment,{children:[r.length===0?e.jsx(b,{children:e.jsx(x,{opacity:"0.5",children:"виджеты не найдены (это как вообще? обратитесь в поддержку)"})}):e.jsx(E,{in:c,animateOpacity:!0,children:e.jsxs(f,{children:[e.jsx(_,{children:"ссылка для встраивания"}),e.jsxs(G,{children:[e.jsx(F,{color:"brand.300",value:`https://widget.tipmeadollar.com/?key=${(p=s.props.auth)==null?void 0:p.profile.api_token}`,isReadOnly:!0,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},cursor:"pointer",onClick:()=>{var t;N(`https://widget.tipmeadollar.com/?key=${(t=s.props.auth)==null?void 0:t.profile.api_token}`)}}),e.jsx(O,{width:"3rem",children:e.jsx(v,{"aria-label":"copy",icon:e.jsx(P,{}),maxW:"1.75rem",minW:"1.75rem",variant:"ghost",h:"1.75rem",size:"sm",onClick:()=>{var t;window.navigator.clipboard.writeText(`https://widget.tipmeadollar.com/?key=${(t=s.props.auth)==null?void 0:t.profile.api_token}`),a({title:"cсылка скопирована"})}})})]}),e.jsx($,{fontWeight:"bold",children:"никому не показывайте ссылку!"})]})}),e.jsxs(M,{columns:[1,2,3],spacing:2,children:[e.jsx(b,{cursor:"pointer",bgColor:"#202020",borderRadius:"lg",p:3,border:"1px solid",borderColor:"transparent",transitionProperty:"var(--aithercol-transition-property-common)",transitionDuration:"var(--aithercol-transition-duration-fast)",transitionTimingFunction:"var(--aithercol-transition-easing-ease-out)",_hover:{borderColor:"brand.500"},onClick:d.onOpen,children:e.jsxs(i,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(J,{}),e.jsx(g,{size:"sm",children:"новый виджет"})]})}),r.map(t=>{var o;return e.jsxs(i,{bgColor:"#202020",borderRadius:"lg",p:3,direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,children:[e.jsxs(i,{direction:"column",spacing:0,children:[e.jsx(g,{size:"sm",children:t.is_default?"стандартный виджет":"дополнительный виджет"}),e.jsxs(x,{fontSize:"sm",children:["если сумма доната ",D[t.condition_type]," ",(t.condition_amount/100).toFixed(2)," ",(o=s.props.auth)==null?void 0:o.profile.default_currency]})]}),e.jsx(v,{"aria-label":"settings",icon:e.jsx(K,{}),size:"sm",onClick:()=>l(`/dashboard/widgets/notifications/${t.id}`),variant:"ghost"})]})})]})]}):e.jsx(b,{children:e.jsx(A,{color:"brand.300",size:"xl"})}),e.jsx(X,{...d,refreshData:n})]})}export{D as condition,U as default};
