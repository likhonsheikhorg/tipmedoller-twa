import{u as Z,r as u,A as ee,s as re,f as p,g as x,h as se,j as e,i as oe,S as y,C as ae,d as te,k as C,l as S,J as ne,o as F,n as T,aN as k,q as W,I as ie,aO as ce,H as le,T as f}from"./index-P0oc4blE.js";function ue(b){var I,M,$,D,N,V,q,A,B,H,z,E,L,P;const h=Z(),a=u.useContext(ee),[m,j]=re(),[c,J]=u.useState(),[g,O]=u.useState(),[v,w]=u.useState(null);u.useEffect(()=>{(async()=>{var t,i;const r=await p.get("/internal/fiat_rates",{},(t=a.props.auth)==null?void 0:t.token);if(r.errors){x(r.errors,h);return}O(r.rates);const o=await p.get("/dashboard/withdrawals/get_methods",{},(i=a.props.auth)==null?void 0:i.token);if(o.errors){x(o.errors,h);return}J(o.methods)})()},[]);const{register:_,handleSubmit:G,formState:{errors:l,isSubmitting:K,isValid:Q},reset:U,watch:n,getValues:X}=se({mode:"onChange"}),Y=async r=>{var t;const o=await p.post("/dashboard/withdrawals/create",{...r,amount:(r.amount*100).toFixed(0)},(t=a.props.auth)==null?void 0:t.token);if(o.errors){x(o.errors,h);return}await b.refresh(),await a.updateProfile(),U(),w(null),b.onClose()},s=()=>c==null?void 0:c.find(r=>r.code===n("method.code"));return e.jsx(oe,{title:"создать выплату",...b,children:e.jsx("form",{onSubmit:G(Y),children:e.jsx(y,{direction:"column",spacing:2,children:e.jsx(e.Fragment,{children:c?e.jsx(e.Fragment,{children:v?e.jsxs(e.Fragment,{children:[e.jsxs(y,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(ie,{"aria-label":"back",icon:e.jsx(ce,{}),size:"sm",variant:"ghost",onClick:()=>w(null)}),e.jsx(le,{size:"sm",children:"проверьте информацию"})]}),e.jsxs(y,{direction:"column",spacing:0,children:[e.jsxs(f,{children:["будет отправлено:"," ",v.user_get.method_currency/100," ",(z=s())==null?void 0:z.currency]}),e.jsxs(f,{children:["комиссия: ",v.commission.method_currency/100," ",(E=s())==null?void 0:E.currency]}),e.jsxs(f,{children:["метод: ",(L=s())==null?void 0:L.name]}),e.jsxs(f,{children:[(P=s())==null?void 0:P.valueName,": ",n("method.value")]})]}),e.jsx(W,{type:"submit",isDisabled:K,children:"создать"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(C,{isInvalid:!!((I=l.method)!=null&&I.code),children:[e.jsx(S,{children:"метод"}),e.jsx(ne,{isDisabled:m,placeholder:"выберите метод",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},..._("method.code",{required:!0}),children:c==null?void 0:c.map(r=>e.jsx("option",{value:r.code,children:r.name}))}),e.jsx(F,{error:(M=l.method)==null?void 0:M.code,text:n("method.code")?`Комиссия: ${($=s())==null?void 0:$.commission_percent}%`+(((D=s())==null?void 0:D.commission_amount)!==0?` + ${((N=s())==null?void 0:N.commission_amount)/100} ${(V=s())==null?void 0:V.currency}`:""):void 0})]}),n("method.code")&&e.jsxs(e.Fragment,{children:[e.jsxs(C,{isInvalid:!!((q=l.method)!=null&&q.value),children:[e.jsx(S,{children:(A=s())==null?void 0:A.valueName}),e.jsx(T,{isDisabled:m,placeholder:`введите ${(B=s())==null?void 0:B.valueName}`,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},..._("method.value",{required:!0})}),e.jsx(F,{error:(H=l.method)==null?void 0:H.value})]}),e.jsxs(C,{isInvalid:!!l.amount,children:[e.jsx(S,{children:"сумма"}),e.jsx(T,{isDisabled:m,placeholder:"введите сумму",_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},..._("amount",{required:!0,valueAsNumber:!0,validate:r=>{var o,t,i,d,R;return r>0&&r<=(((o=a.props.auth)==null?void 0:o.profile.balance)||0)&&r>=(((t=s())==null?void 0:t.currency)===((i=a.props.auth)==null?void 0:i.profile.default_currency)?((d=s())==null?void 0:d.min_amount)/100:Math.ceil(k(g,s().min_amount,s().currency,((R=a.props.auth)==null?void 0:R.profile.default_currency)||"")/100))||"bad_number"}})}),e.jsx(F,{error:l.amount,errorReplacer:r=>{var o,t,i,d;return n("amount")>=(((o=a.props.auth)==null?void 0:o.profile.balance)||0)?"недостаточно средств на балансе":n("amount")<Math.ceil(k(g,s().min_amount,s().currency,((t=a.props.auth)==null?void 0:t.profile.default_currency)||"")/100)&&n("amount")>0?`минимальная сумма для вывода: ${Math.ceil(k(g,s().min_amount,s().currency,((i=a.props.auth)==null?void 0:i.profile.default_currency)||"")/100)} ${(d=a.props.auth)==null?void 0:d.profile.default_currency}`:r}})]}),e.jsx(W,{onClick:async()=>{var o;j.on();const r=await p.post("/dashboard/withdrawals/create/preview",{...X(),amount:(n("amount")*100).toFixed(0)},(o=a.props.auth)==null?void 0:o.token);if(r.errors){x(r.errors,h),j.off();return}w(r.result),j.off()},isDisabled:!Q||m,children:"далее"})]})]})}):e.jsx(ae,{children:e.jsx(te,{size:"xl",color:"brand.300"})})})})})})}export{ue as W};
