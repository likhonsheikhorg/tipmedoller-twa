import{aq as xe,r as u,Y as q,a9 as Y,ar as be,a8 as me,as as je,a6 as ge,Z as N,aa as fe,ab as pe,j as e,$ as R,a0 as W,u as D,A as P,S as x,H as k,M as J,a as Q,L as ee,b as se,c as F,C as w,d as M,T as g,e as ye,f as _,m as L,g as T,s as B,i as G,R as Ce,q as E,at as Z,U as we,n as ve,t as K,au as _e,av as Te,aw as te,I as A,ax as Se,ay as ke,az as ze,aA as Be,aB as De,aC as Pe,aD as Ie}from"./index-P0oc4blE.js";import{R as Me,A as Le,X as Fe,Y as Ae,T as Ee,a as Ne}from"./AreaChart-Dq_w5xpa.js";import{T as ne,a as oe,b as re,c as U,d as p,e as ae,g as ie,f as y}from"./chunk-MGVPL3OH-D2E27idd.js";import{u as Re,T as O}from"./chunk-TK6VMDNP-DTNDeJlA.js";import{W as We}from"./WithdrawModal-Cv1X_x1r.js";import"./clsx-B-dksMZM.js";var[Oe,$e,He,Ke]=xe();function Ue(s){var o;const{defaultIndex:n,onChange:r,index:t,isManual:d,isLazy:h,lazyBehavior:a="unmount",orientation:i="horizontal",direction:l="ltr",...c}=s,[j,b]=u.useState(n??0),[f,z]=Re({defaultValue:n??0,value:t,onChange:r});u.useEffect(()=>{t!=null&&b(t)},[t]);const m=He(),C=u.useId();return{id:`tabs-${(o=s.id)!=null?o:C}`,selectedIndex:f,focusedIndex:j,setSelectedIndex:z,setFocusedIndex:b,isManual:d,isLazy:h,lazyBehavior:a,orientation:i,descendants:m,direction:l,htmlProps:c}}var[Ve,V]=q({name:"TabsContext",errorMessage:"useTabsContext: `context` is undefined. Seems you forgot to wrap all tabs components within <Tabs />"});function Xe(s){const{focusedIndex:o,orientation:n,direction:r}=V(),t=$e(),d=u.useCallback(h=>{const a=()=>{var v;const S=t.nextEnabled(o);S&&((v=S.node)==null||v.focus())},i=()=>{var v;const S=t.prevEnabled(o);S&&((v=S.node)==null||v.focus())},l=()=>{var v;const S=t.firstEnabled();S&&((v=S.node)==null||v.focus())},c=()=>{var v;const S=t.lastEnabled();S&&((v=S.node)==null||v.focus())},j=n==="horizontal",b=n==="vertical",f=h.key,z=r==="ltr"?"ArrowLeft":"ArrowRight",m=r==="ltr"?"ArrowRight":"ArrowLeft",I={[z]:()=>j&&i(),[m]:()=>j&&a(),ArrowDown:()=>b&&a(),ArrowUp:()=>b&&i(),Home:l,End:c}[f];I&&(h.preventDefault(),I(h))},[t,o,n,r]);return{...s,role:"tablist","aria-orientation":n,onKeyDown:Y(s.onKeyDown,d)}}function Ye(s){const{isDisabled:o=!1,isFocusable:n=!1,...r}=s,{setSelectedIndex:t,isManual:d,id:h,setFocusedIndex:a,selectedIndex:i}=V(),{index:l,register:c}=Ke({disabled:o&&!n}),j=l===i,b=()=>{t(l)},f=()=>{a(l),!d&&!(o&&n)&&t(l)};return{...be({...r,ref:me(c,s.ref),isDisabled:o,isFocusable:n,onClick:Y(s.onClick,b)}),id:ce(h,l),role:"tab",tabIndex:j?0:-1,type:"button","aria-selected":j,"aria-controls":le(h,l),onFocus:o?void 0:Y(s.onFocus,f)}}var[qe,Ge]=q({});function Ze(s){const o=V(),{id:n,selectedIndex:r}=o,d=je(s.children).map((h,a)=>u.createElement(qe,{key:a,value:{isSelected:a===r,id:le(n,a),tabId:ce(n,a),selectedIndex:r}},h));return{...s,children:d}}function Je(s){const{children:o,...n}=s,{isLazy:r,lazyBehavior:t}=V(),{isSelected:d,id:h,tabId:a}=Ge(),i=u.useRef(!1);d&&(i.current=!0);const l=ge({wasSelected:i.current,isSelected:d,enabled:r,mode:t});return{tabIndex:0,...n,children:l?o:null,role:"tabpanel","aria-labelledby":a,hidden:!d,id:h}}function ce(s,o){return`${s}--tab-${o}`}function le(s,o){return`${s}--tabpanel-${o}`}var[Qe,X]=q({name:"TabsStylesContext",errorMessage:`useTabsStyles returned is 'undefined'. Seems you forgot to wrap the components in "<Tabs />" `}),de=N(function(o,n){const r=fe("Tabs",o),{children:t,className:d,...h}=pe(o),{htmlProps:a,descendants:i,...l}=Ue(h),c=u.useMemo(()=>l,[l]),{isFitted:j,...b}=a,f={position:"relative",...r.root};return e.jsx(Oe,{value:i,children:e.jsx(Ve,{value:c,children:e.jsx(Qe,{value:r,children:e.jsx(R.div,{className:W("chakra-tabs",d),ref:n,...b,__css:f,children:t})})})})});de.displayName="Tabs";var he=N(function(o,n){const r=Xe({...o,ref:n}),d={display:"flex",...X().tablist};return e.jsx(R.div,{...r,className:W("chakra-tabs__tablist",o.className),__css:d})});he.displayName="TabList";var $=N(function(o,n){const r=Je({...o,ref:n}),t=X();return e.jsx(R.div,{outline:"0",...r,className:W("chakra-tabs__tab-panel",o.className),__css:t.tabpanel})});$.displayName="TabPanel";var ue=N(function(o,n){const r=Ze(o),t=X();return e.jsx(R.div,{...r,width:"100%",ref:n,className:W("chakra-tabs__tab-panels",o.className),__css:t.tabpanels})});ue.displayName="TabPanels";var H=N(function(o,n){const r=X(),t=Ye({...o,ref:n}),d={outline:"0",display:"flex",alignItems:"center",justifyContent:"center",...r.tab};return e.jsx(R.button,{...t,className:W("chakra-tabs__tab",o.className),__css:d})});H.displayName="Tab";function es(){var f,z;const s=D(),o=u.useContext(P),[n,r]=u.useState(null),[t,d]=u.useState("month"),h={today:"за 24 часа",week:"за неделю",month:"за месяц",year:"за год"},[a,i]=u.useState(null),[l,c]=u.useState("current"),j=async()=>{var C;r(null);const m=await _.get("/dashboard/stats/dynamic",{date:t,timezone:L.tz.guess(),admin:!0},(C=o.props.auth)==null?void 0:C.token);if(m.errors){T(m.errors,s);return}r(m.data)},b=async()=>{var C;i(null);const m=await _.get("/dashboard/stats/total",{month:l,timezone:L.tz.guess(),admin:!0},(C=o.props.auth)==null?void 0:C.token);if(m.errors){T(m.errors,s);return}i(m.data)};return u.useEffect(()=>{j()},[t]),u.useEffect(()=>{b()},[l]),e.jsx(x,{direction:"column",spacing:4,children:e.jsx(x,{direction:["column","row"],spacing:3,w:"full",children:e.jsxs(x,{maxW:["full"],w:"full",direction:"column",spacing:3,children:[e.jsxs(x,{bgColor:"#202020",direction:"column",spacing:3,p:4,borderRadius:"lg",w:"full",h:"280px",children:[e.jsxs(x,{direction:["column","row"],spacing:2,alignItems:["start","center"],justifyContent:"space-between",children:[e.jsx(k,{size:"md",children:"динамика"}),e.jsxs(J,{children:[e.jsx(Q,{children:e.jsx(ee,{color:"brand.300",fontSize:"sm",children:h[t]})}),e.jsxs(se,{bgColor:"#202020",children:[e.jsx(F,{bgColor:"#202020",_hover:{bgColor:"#252525"},onClick:()=>{d("week")},children:h.week}),e.jsx(F,{bgColor:"#202020",_hover:{bgColor:"#252525"},onClick:()=>{d("month")},children:h.month}),e.jsx(F,{bgColor:"#202020",_hover:{bgColor:"#252525"},onClick:()=>{d("year")},children:h.year})]})]})]}),n?e.jsx(e.Fragment,{children:n.length!==0?e.jsx(Me,{width:"100%",height:"100%",children:e.jsxs(Le,{height:300,data:n.map(m=>({name:m.date,amount:m.amount/100})),children:[e.jsx(Fe,{fontSize:"12px",dataKey:"name"}),e.jsx(Ae,{}),e.jsx(Ee,{content:({active:m,payload:C})=>{var I;return m&&C&&C.length?e.jsxs(x,{direction:"column",spacing:0,bgColor:"#252525",borderRadius:"md",p:2,children:[e.jsx(g,{fontSize:"xs",opacity:"0.5",children:C[0].payload.name}),e.jsxs(k,{size:"sm",children:[C[0].value," ",(I=o.props.auth)==null?void 0:I.profile.default_currency]})]}):null}}),e.jsx(Ne,{type:"monotone",dataKey:"amount",stroke:"#800000",fill:"#800000"})]})}):e.jsx(w,{h:"full",children:e.jsx(g,{opacity:"0.5",children:"нет данных"})})}):e.jsx(w,{h:"full",children:e.jsx(M,{size:"xl",color:"brand.300"})})]}),e.jsxs(x,{bgColor:"#202020",direction:"column",spacing:3,p:4,borderRadius:"lg",w:"full",children:[e.jsxs(x,{direction:["column","row"],justifyContent:"space-between",alignItems:["start","center"],children:[e.jsx(k,{size:"md",children:"статистика"}),e.jsxs(J,{children:[e.jsx(Q,{children:e.jsx(ee,{color:"brand.300",fontSize:"sm",children:l==="current"?"за текущий месяц":"за предыдущий месяц"})}),e.jsxs(se,{bgColor:"#202020",children:[e.jsx(F,{bgColor:"#202020",_hover:{bgColor:"#252525"},onClick:()=>{c("current")},children:"за текущий месяц"}),e.jsx(F,{bgColor:"#202020",_hover:{bgColor:"#252525"},onClick:()=>{c("prev")},children:"за предыдущий месяц"})]})]})]}),a===null?e.jsx(w,{h:"full",children:e.jsx(M,{size:"xl",color:"brand.300"})}):e.jsxs(ye,{columns:[1,2,3],spacing:3,children:[e.jsxs(x,{direction:"column",spacing:0,children:[e.jsxs(k,{size:"lg",children:[a.total_admin/100," ",(f=o.props.auth)==null?void 0:f.profile.default_currency]}),e.jsx(g,{opacity:"0.5",children:"заработано"})]}),e.jsxs(x,{direction:"column",spacing:0,children:[e.jsxs(k,{size:"lg",children:[a.total/100," ",(z=o.props.auth)==null?void 0:z.profile.default_currency]}),e.jsx(g,{opacity:"0.5",children:"собрано"})]}),e.jsxs(x,{direction:"column",spacing:0,children:[e.jsx(k,{size:"lg",children:a.count}),e.jsx(g,{opacity:"0.5",children:"донатов"})]})]})]})]})})})}function ss(s){const o=D(),n=u.useContext(P),[r,t]=u.useState(),[d,h]=B(),[a,i]=u.useState(),l=async c=>{var b;h.on();const j=await _.get("/dashboard/admin/donations",{page:c||1,limit:25,user:s.user.id},(b=n.props.auth)==null?void 0:b.token);if(j.errors){T(j.errors,o);return}t(c?[...r||[],...j.donations.data]:j.donations.data),i(j.donations.meta),h.off()};return u.useEffect(()=>{s.isOpen&&l()},[s.isOpen]),e.jsx(G,{size:"lg",title:"донаты",...s,children:r?e.jsxs(x,{direction:"column",spacing:2,children:[r.map(c=>e.jsxs(x,{direction:"column",spacing:1,bgColor:"#252525",p:3,borderRadius:"lg",children:[e.jsxs(g,{children:[e.jsx("b",{children:c.name||"аноним"})," отправил"," ",e.jsxs("b",{children:[c.amount/100," ",c.currency]})]}),c.message?e.jsx(g,{fontSize:"sm",children:c.message}):null,c.audio?e.jsx(Ce,{controls:!0,src:c.audio}):null,e.jsxs(x,{direction:"column",spacing:0,children:[e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Email:"})," ",c.email]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Метод:"})," ",c.payment_method]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Оплачен:"})," ",L(c.paid_at).format("LLL")]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Создан:"})," ",L(c.created_at).format("LLL")]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Пользователь оплатил:"})," ",c.user_amount/100," ",c.currency]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Стример получил:"})," ",(c.amount-c.commission_amount)/100," ",c.currency]}),e.jsxs(g,{fontSize:"sm",opacity:"0.5",children:[e.jsx("b",{children:"Админы получили:"})," ",c.admin_amount/100," ",c.currency]})]})]})),(a==null?void 0:a.current_page)!==(a==null?void 0:a.last_page)&&e.jsx(w,{children:e.jsx(E,{isDisabled:d,onClick:()=>l((a==null?void 0:a.current_page)+1),children:"показать еще"})})]}):e.jsx(w,{children:e.jsx(M,{size:"xl",color:"brand.300"})})})}function ts(s){const o=D(),[n,r]=u.useState(),t=u.useContext(P),[d,h]=B();return u.useEffect(()=>{s.isOpen&&!n&&(async()=>{s.user.p2p_mode?h.on():h.off();const a=await _.get("/internal/payment_methods");if(a.errors){T(a.errors,o);return}r(a.methods)})()},[s.isOpen]),e.jsx(G,{title:"методы",...s,children:n?e.jsxs(x,{direction:"column",spacing:2,children:[e.jsxs(x,{direction:"column",spacing:0,children:[e.jsxs(x,{direction:"row",justifyContent:"space-between",alignItems:"center",spacing:4,children:[e.jsx(k,{size:"sm",children:"P2P режим"}),e.jsx(Z,{colorScheme:"brand",isChecked:d,onChange:async()=>{var i;h.toggle();const a=await _.post("/dashboard/admin/users/update",{action:"toggleP2PMode",id:s.user.id},(i=t.props.auth)==null?void 0:i.token);if(a.errors){T(a.errors,o),h.toggle();return}}})]}),e.jsx(g,{fontSize:"sm",opacity:"0.5",children:"используется для стримеров, которые нарушают правила платежной системы РФ"})]}),n.map(a=>e.jsx(ns,{...s,method:a}))]}):e.jsx(w,{children:e.jsx(M,{size:"xl",color:"brand.300"})})})}const ns=({method:s,...o})=>{const n=D(),r=u.useContext(P),[t,d]=B(),[h,a]=B(!o.user.disabled_methods.includes(s.code));return e.jsxs(x,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(we,{src:s.image,w:"40px",h:"40px",borderRadius:"999px"}),e.jsx(k,{size:"sm",children:s.name})]}),e.jsx(Z,{colorScheme:"brand",isChecked:h,isDisabled:t,onChange:async()=>{var l;d.on();const i=await _.post("/dashboard/admin/users/update",{action:"toggleMethod",id:o.user.id,method:s.code},(l=r.props.auth)==null?void 0:l.token);if(i.errors){T(i.errors,n),d.off();return}a.toggle(),d.off()}})]})};function os(){const s=D(),o=u.useContext(P),[n,r]=u.useState(),[t,d]=u.useState(),[h,a]=u.useState(""),[i,l]=u.useState({balance:!1,search:""}),[c,j]=B(),b=async f=>{var z;j.on();try{const m=await _.get("/dashboard/admin/users",{page:f||1,limit:25,...i},(z=o.props.auth)==null?void 0:z.token);if(m.errors){T(m.errors,s);return}r(f?[...n||[],...m.users.data]:m.users.data),d(m.users.meta)}catch(m){console.error(m)}finally{j.off()}};return u.useEffect(()=>{b()},[i]),u.useEffect(()=>{if(t){const f=setTimeout(()=>{l({...i,search:h})},500);return()=>clearTimeout(f)}},[h]),e.jsx(e.Fragment,{children:n?e.jsxs(x,{direction:"column",spacing:2,children:[e.jsxs(x,{direction:["column","row"],justifyContent:"space-between",spacing:2,alignItems:["start","center"],children:[e.jsx(ve,{placeholder:"поиск по ID, логину, email",isDisabled:c,_focusVisible:{borderColor:"brand.500",boxShadow:"0 0 0 1px var(--aithercol-colors-brand-500)"},value:h,onChange:f=>a(f.currentTarget.value),maxW:["full","250px"]}),e.jsxs(x,{alignItems:"center",direction:"row",spacing:2,children:[e.jsx(Z,{isChecked:i.balance,onChange:()=>l({...i,balance:!i.balance}),colorScheme:"brand",size:"lg",isDisabled:c}),e.jsx(g,{children:"только с балансом"})]})]}),n.length===0&&e.jsx(w,{children:e.jsx(g,{opacity:"0.5",children:"пользователи не найдены"})}),n.length!==0&&e.jsx(ne,{children:e.jsxs(oe,{variant:"simple",children:[e.jsx(re,{children:e.jsxs(U,{children:[e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"ID"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"логин"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"email"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"баланс"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"комиссия"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"дата регистрации"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"флаги"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5"})]})}),e.jsx(ae,{children:n.map(f=>e.jsx(rs,{user:f,refresh:()=>b()}))}),(t==null?void 0:t.current_page)!==(t==null?void 0:t.last_page)&&e.jsx(ie,{mt:0,children:e.jsx(w,{children:e.jsx(E,{isDisabled:c,onClick:()=>b((t==null?void 0:t.current_page)+1),children:"показать еще"})})})]})})]}):e.jsx(w,{children:e.jsx(M,{color:"brand.300",size:"xl"})})})}function rs({user:s,refresh:o}){const[n,r]=B(),t=u.useContext(P),d=D(),h=K(),a=K();return e.jsxs(U,{children:[e.jsxs(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:["#",s.id]}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:e.jsxs(x,{direction:"row",spacing:2,alignItems:"center",children:[e.jsx(_e,{size:"sm",src:s.avatar+"?d=retro"}),e.jsx("span",{children:s.username}),s.is_verified?e.jsxs(Te,{fill:"none",height:"20px",viewBox:"0 0 26 26",width:"20px",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"m6 6h12v12h-12z",fill:"#fff"}),e.jsx("path",{"clip-rule":"evenodd",d:"m14.38 1.51 1.82 1.82c.37.37.86.57 1.38.57h2.57c1.01 0 1.85.77 1.94 1.76l.01.19v2.57c0 .52.21 1.01.57 1.38l1.82 1.82c.71.71.76 1.84.13 2.61l-.13.15-1.82 1.82c-.37.37-.57.86-.57 1.38v2.57c0 1.01-.77 1.85-1.76 1.94l-.19.01h-2.57c-.52 0-1.01.21-1.38.57l-1.82 1.82c-.71.71-1.84.76-2.61.13l-.15-.13-1.82-1.82c-.37-.37-.86-.57-1.38-.57h-2.57c-1.01 0-1.85-.77-1.94-1.76l-.01-.19v-2.57c0-.52-.21-1.01-.57-1.38l-1.82-1.82c-.71-.71-.76-1.84-.13-2.61l.13-.15 1.82-1.82c.37-.37.57-.86.57-1.38v-2.57c0-1.08.87-1.95 1.95-1.95h2.57c.52 0 1.01-.21 1.38-.57l1.82-1.82c.76-.76 2-.76 2.76 0zm3.2 8.05c-.43-.34-1.03-.31-1.42.06l-.1.11-4.45 5.56-1.75-1.75-.11-.1c-.42-.32-1.03-.29-1.42.1s-.42.99-.1 1.42l.1.11 2.6 2.6.11.1c.42.32 1.02.29 1.4-.08l.1-.11 5.2-6.5.08-.12c.27-.46.17-1.05-.25-1.4z",fill:"var(--aithercol-colors-brand-300)","fill-rule":"evenodd"})]}):e.jsx(e.Fragment,{})]})}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.email}),e.jsxs(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.balance/100," ",s.default_currency]}),e.jsxs(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.commission_percent,"%"]}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:L(s.created_at).format("LLL")}),e.jsxs(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.is_admin?e.jsx(te,{colorScheme:"green",children:"администратор"}):e.jsx(e.Fragment,{})," ",s.is_banned?e.jsx(te,{colorScheme:"brand",children:"забанен"}):e.jsx(e.Fragment,{})]}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:e.jsxs(x,{direction:"row",spacing:2,children:[e.jsx(O,{label:s.is_banned?"разбанить":"забанить",children:e.jsx(A,{"aria-label":"ban",icon:s.is_banned?e.jsx(Se,{}):e.jsx(ke,{}),isDisabled:n,onClick:async()=>{var l;r.on();const i=await _.post("/dashboard/admin/users/update",{action:s.is_banned?"unban":"ban",id:s.id},(l=t.props.auth)==null?void 0:l.token);if(i.errors){T(i.errors,d),r.off();return}d({status:"success",title:`пользователь ${s.is_banned?"разбанен":"забанен"}!`}),await o(),r.off()}})}),e.jsx(O,{label:s.is_verified?"снять верификацию":"верифицировать",children:e.jsx(A,{"aria-label":"verify",icon:s.is_verified?e.jsx(ze,{}):e.jsx(Be,{}),isDisabled:n,onClick:async()=>{var l;r.on();const i=await _.post("/dashboard/admin/users/update",{action:"toggleVerified",id:s.id},(l=t.props.auth)==null?void 0:l.token);if(i.errors){T(i.errors,d),r.off();return}d({status:"success",title:"успешно!"}),await o(),r.off()}})}),e.jsx(O,{label:"донаты",children:e.jsx(A,{onClick:a.onOpen,"aria-label":"donates",icon:e.jsx(De,{}),isDisabled:n})}),e.jsx(O,{label:"методы",children:e.jsx(A,{onClick:h.onOpen,"aria-label":"methods",icon:e.jsx(Pe,{}),isDisabled:n})})]})}),e.jsx(ts,{...h,user:s}),e.jsx(ss,{...a,user:s})]})}function as(s){const o=D(),n=u.useContext(P),[r,t]=B(),[d,h]=u.useState();u.useEffect(()=>{s.isOpen&&(async()=>{var l;const i=await _.post("/dashboard/withdrawals/create/preview",{user:s.user,method:s.withdraw.payment_method,amount:s.withdraw.amount},(l=n.props.auth)==null?void 0:l.token);if(i.errors){T(i.errors,o),t.off();return}h(i.result)})()},[s.isOpen]);const a=async i=>{var c;const l=await _.post("/dashboard/admin/withdrawals/handle",{id:s.withdraw.id,status:i},(c=n.props.auth)==null?void 0:c.token);if(l.errors){T(l.errors,o),t.off();return}s.refresh(),s.onClose(),t.off()};return e.jsx(G,{title:"обработка выплаты",...s,children:e.jsx(x,{direction:"column",spacing:2,children:d?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:"sm",children:"отправьте выплату"}),e.jsxs(x,{direction:"column",spacing:0,children:[e.jsxs(g,{children:["сумма: ",d.user_get.method_currency/100," ",s.withdraw.payment_method.currency]}),e.jsxs(g,{children:["метод: ",s.withdraw.payment_method.name]}),e.jsxs(g,{children:[s.withdraw.payment_method.valueName,":"," ",s.withdraw.payment_method.value]})]}),e.jsx(E,{isDisabled:r,onClick:()=>a("ok"),children:"отправлено"}),e.jsx(E,{isDisabled:r,onClick:()=>a("error"),variant:"ghost",children:"произошла ошибка"})]}):e.jsx(w,{children:e.jsx(M,{size:"xl",color:"brand.300"})})})})}function is(){const s=u.useContext(P),o=D(),[n,r]=u.useState(),[t,d]=u.useState(),[h,a]=B(),i=async c=>{var j;a.on();try{const b=await _.get("/dashboard/admin/withdrawals",{page:c||1,limit:25},(j=s.props.auth)==null?void 0:j.token);if(b.errors){T(b.errors,o);return}r(c?[...n||[],...b.withdrawals.data]:b.withdrawals.data),d(b.withdrawals.meta)}catch(b){console.error(b)}finally{a.off()}};u.useEffect(()=>{i()},[]);const l=K();return e.jsxs(x,{direction:"column",spacing:4,children:[e.jsx(k,{children:"выплаты"}),n?e.jsx(e.Fragment,{children:n.length===0?e.jsx(w,{children:e.jsx(g,{opacity:"0.5",children:"выплаты не найдены"})}):e.jsx(ne,{children:e.jsxs(oe,{variant:"simple",children:[e.jsx(re,{children:e.jsxs(U,{children:[e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"#"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"ID пользователя"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"получатель"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"сумма"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"метод"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"дата и время"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5",children:"статус"}),e.jsx(p,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:"white",opacity:"0.5"})]})}),e.jsx(ae,{children:n.map(c=>e.jsx(cs,{withdraw:c,refresh:i}))}),(t==null?void 0:t.current_page)!==(t==null?void 0:t.last_page)&&e.jsx(ie,{mt:0,children:e.jsx(w,{children:e.jsx(E,{isDisabled:h,onClick:()=>i((t==null?void 0:t.current_page)+1),children:"показать еще"})})})]})})}):e.jsx(w,{children:e.jsx(M,{color:"brand.300",size:"xl"})}),e.jsx(We,{refresh:i,...l})]})}function cs({withdraw:s,refresh:o}){const n={ok:{text:"успешно",color:"green.500"},waiting:{text:"в обработке",color:"yellow.500"},error:{text:"ошибка",color:"red.500"}},r=K();return e.jsxs(U,{children:[e.jsxs(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:["#",s.id]}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.user_id}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.payment_method.value}),e.jsxs(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:[s.amount/100," ",s.currency]}),e.jsx(y,{opacity:"0.5",borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.commission_amount!==0?`-${(s.commission_amount/100).toFixed(2)} ${s.currency}`:""}),e.jsx(y,{maxW:"300px",css:{textWrap:"balance"},borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.payment_method.name}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:L(s.created_at).format("LLL")}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",color:n[s.status].color,children:n[s.status].text}),e.jsx(y,{borderBottomColor:"rgba(255, 255, 255, 0.3)",children:s.status==="waiting"?e.jsx(A,{"aria-label":"handle",onClick:r.onOpen,icon:e.jsx(Ie,{})}):e.jsx(e.Fragment,{})}),e.jsx(as,{...r,refresh:o,user:s.user_id,withdraw:s})]})}function ms(){return e.jsxs(x,{direction:"column",spacing:4,children:[e.jsx(k,{children:"админка"}),e.jsxs(de,{isLazy:!0,colorScheme:"brand",children:[e.jsxs(he,{children:[e.jsx(H,{children:"пользователи"}),e.jsx(H,{children:"выплаты"}),e.jsx(H,{children:"статистика"})]}),e.jsxs(ue,{children:[e.jsx($,{children:e.jsx(os,{})}),e.jsx($,{children:e.jsx(is,{})}),e.jsx($,{children:e.jsx(es,{})})]})]})]})}export{ms as default};
